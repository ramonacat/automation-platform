name: build
on: [push]
jobs:
    build-dev:
        runs-on: ubuntu-20.04
        steps:
            - uses: actions/checkout@v3
              with:
                fetch-depth: 0

            - uses: cachix/install-nix-action@v17
              with:
                nix_path: nixpkgs=channel:nixos-22.11
                authToken: '${{ secrets.CACHIX_AUTH_TOKEN }}'

            - uses: cachix/cachix-action@v11
              with:
                name: automation-platform

            - working-directory: tools/dependabot-config-checker/
              run: nix-shell --command "composer install"

            - working-directory: tools/dependabot-config-checker/
              run: nix-shell --command "php bin/check.php"

            - working-directory: tools/build/
              run: nix-shell --command "composer install"

            - working-directory: tools/machine-info
              run: nix-shell --command "cargo build --release"

            - run: nix-shell --command "php tools/build/bin/build.php --environment=github-actions build"